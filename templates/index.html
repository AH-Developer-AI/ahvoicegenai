<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>üéôÔ∏è AirVoz Voice Browser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    :root{
      --bg:#0a0e1f; --panel:#0f1629; --card:#141b32; --muted:#8897bb; --text:#e8f0ff; 
      --brand:#4c8eff; --accent:#5ce4b3; --danger:#ff5a5a; --warning:#ffb84d;
      --shadow:0 12px 40px rgba(0,0,0,.5); --glow:0 0 20px rgba(76,142,255,.3);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{
      height:100%;
      font-family:'Inter',-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Arial,sans-serif;
      background:linear-gradient(135deg,#0a0e1f 0%,#151d38 50%,#0a0e1f 100%);
      color:var(--text);
      overflow-x:hidden;
    }
    body::before{
      content:'';
      position:fixed;
      top:-50%;
      left:-50%;
      width:200%;
      height:200%;
      background:radial-gradient(circle at 20% 50%, rgba(76,142,255,.08) 0%, transparent 50%),
                 radial-gradient(circle at 80% 80%, rgba(92,228,179,.06) 0%, transparent 50%);
      animation:drift 20s ease-in-out infinite;
      pointer-events:none;
      z-index:0;
    }
    @keyframes drift{
      0%,100%{transform:translate(0,0) rotate(0deg)}
      33%{transform:translate(10px,-20px) rotate(1deg)}
      66%{transform:translate(-10px,10px) rotate(-1deg)}
    }
    .container{
      position:relative;
      z-index:1;
      max-width:1400px;
      margin:0 auto;
      padding:40px 24px;
    }
    
    /* Header */
    header{
      background:linear-gradient(135deg,rgba(20,27,50,.95),rgba(15,22,41,.95));
      backdrop-filter:blur(20px);
      border:1px solid rgba(76,142,255,.15);
      border-radius:var(--radius);
      padding:32px;
      margin-bottom:24px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    header::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:3px;
      background:linear-gradient(90deg,var(--brand),var(--accent),var(--brand));
      background-size:200% 100%;
      animation:shimmer 3s linear infinite;
    }
    @keyframes shimmer{
      to{background-position:200% 0}
    }
    h1{
      font-size:28px;
      font-weight:700;
      letter-spacing:.3px;
      margin-bottom:8px;
      background:linear-gradient(135deg,#e8f0ff,#a8c5ff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .subtitle{
      color:var(--muted);
      font-size:15px;
      line-height:1.5;
      margin-bottom:24px;
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
    }
    
    /* Form Elements */
    select{
      appearance:none;
      background:linear-gradient(135deg,#0f1629,#1a2340);
      border:1px solid rgba(76,142,255,.2);
      color:var(--text);
      padding:14px 40px 14px 16px;
      border-radius:12px;
      font-size:14px;
      font-weight:500;
      min-width:280px;
      cursor:pointer;
      transition:all .3s ease;
      background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%238897bb' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 14px center;
    }
    select:hover{
      border-color:rgba(76,142,255,.4);
      box-shadow:0 4px 12px rgba(76,142,255,.15);
    }
    select:focus{
      outline:none;
      border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(76,142,255,.2);
    }
    
    button{
      background:linear-gradient(135deg,#4c8eff,#3d6fd9);
      border:1px solid rgba(76,142,255,.3);
      color:#fff;
      padding:14px 24px;
      border-radius:12px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      transition:all .3s ease;
      box-shadow:0 4px 12px rgba(76,142,255,.25);
    }
    button:hover:not(:disabled){
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(76,142,255,.35);
    }
    button:active:not(:disabled){
      transform:translateY(0);
    }
    button:disabled{
      opacity:.5;
      cursor:not-allowed;
      transform:none;
    }
    
    .badge{
      background:rgba(76,142,255,.12);
      border:1px solid rgba(76,142,255,.25);
      color:#a8c5ff;
      padding:10px 20px;
      border-radius:12px;
      font-size:13px;
      font-weight:600;
    }
    
    /* Status Bar */
    .status-bar{
      background:rgba(15,22,41,.6);
      backdrop-filter:blur(10px);
      border-top:1px solid rgba(76,142,255,.1);
      padding:16px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-radius:var(--radius) var(--radius) 0 0;
    }
    .status-text{
      color:var(--muted);
      font-size:14px;
      font-weight:500;
    }
    .spinner{
      width:20px;
      height:20px;
      border:3px solid rgba(76,142,255,.2);
      border-top-color:#4c8eff;
      border-radius:50%;
      animation:spin .8s linear infinite;
    }
    @keyframes spin{
      to{transform:rotate(360deg)}
    }
    
    /* Voices Grid */
    .voices-section{
      background:linear-gradient(135deg,rgba(20,27,50,.95),rgba(15,22,41,.95));
      backdrop-filter:blur(20px);
      border:1px solid rgba(76,142,255,.15);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .voices-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
      gap:20px;
      padding:24px;
      max-height:calc(100vh - 400px);
      overflow-y:auto;
    }
    .voices-grid::-webkit-scrollbar{
      width:8px;
    }
    .voices-grid::-webkit-scrollbar-track{
      background:rgba(15,22,41,.5);
    }
    .voices-grid::-webkit-scrollbar-thumb{
      background:rgba(76,142,255,.3);
      border-radius:4px;
    }
    
    /* Voice Card */
    .voice-card{
      background:linear-gradient(135deg,#141b32,#0f1629);
      border:1px solid rgba(76,142,255,.15);
      border-radius:14px;
      padding:20px;
      transition:all .3s ease;
      position:relative;
      overflow:hidden;
    }
    .voice-card::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:2px;
      background:linear-gradient(90deg,transparent,var(--brand),transparent);
      opacity:0;
      transition:opacity .3s ease;
    }
    .voice-card:hover{
      transform:translateY(-4px);
      box-shadow:0 12px 30px rgba(76,142,255,.25);
      border-color:rgba(76,142,255,.3);
    }
    .voice-card:hover::before{
      opacity:1;
    }
    
    .voice-header{
      display:flex;
      gap:16px;
      margin-bottom:16px;
    }
    
    /* Avatar with Play Button */
    .avatar-wrapper{
      position:relative;
      flex-shrink:0;
    }
    .avatar{
      width:80px;
      height:80px;
      border-radius:50%;
      border:3px solid rgba(76,142,255,.2);
      object-fit:cover;
      background:linear-gradient(135deg,#1a2340,#0f1629);
      transition:all .3s ease;
    }
    .voice-card:hover .avatar{
      border-color:rgba(76,142,255,.4);
      box-shadow:0 0 20px rgba(76,142,255,.3);
    }
    
    .play-btn{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      width:36px;
      height:36px;
      background:linear-gradient(135deg,rgba(76,142,255,.95),rgba(61,111,217,.95));
      border:2px solid rgba(255,255,255,.3);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:all .3s ease;
      backdrop-filter:blur(10px);
    }
    .play-btn:hover{
      transform:translate(-50%,-50%) scale(1.1);
      box-shadow:0 4px 16px rgba(76,142,255,.5);
    }
    .play-btn::after{
      content:'';
      width:0;
      height:0;
      border-style:solid;
      border-width:6px 0 6px 10px;
      border-color:transparent transparent transparent #fff;
      margin-left:2px;
    }
    .play-btn.playing::after{
      border-style:double;
      border-width:0 0 0 10px;
      border-color:#fff;
      margin-left:0;
    }
    
    .voice-info{
      flex:1;
      min-width:0;
    }
    .voice-name{
      font-size:17px;
      font-weight:700;
      color:var(--text);
      margin-bottom:4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .voice-meta{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .meta-item{
      color:var(--muted);
      font-size:12px;
      font-weight:500;
    }
    .style-badge{
      background:rgba(92,228,179,.15);
      border:1px solid rgba(92,228,179,.3);
      color:#5ce4b3;
      padding:4px 10px;
      border-radius:6px;
      font-size:11px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    
    .voice-id-section{
      background:rgba(10,14,31,.6);
      border:1px solid rgba(76,142,255,.15);
      border-radius:10px;
      padding:12px;
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:16px;
    }
    .voice-id-text{
      flex:1;
      font-family:'SF Mono',Monaco,Consolas,monospace;
      font-size:12px;
      color:#a8c5ff;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .copy-btn{
      background:rgba(76,142,255,.15);
      border:1px solid rgba(76,142,255,.25);
      color:#a8c5ff;
      padding:6px 12px;
      border-radius:8px;
      font-size:11px;
      font-weight:600;
      cursor:pointer;
      transition:all .2s ease;
      flex-shrink:0;
    }
    .copy-btn:hover{
      background:rgba(76,142,255,.25);
      transform:translateY(-1px);
    }
    
    .empty-state{
      text-align:center;
      padding:60px 24px;
      color:var(--muted);
    }
    .empty-icon{
      font-size:48px;
      margin-bottom:16px;
      opacity:.5;
    }
    
    .footer{
      text-align:center;
      margin-top:32px;
      padding:20px;
      color:var(--muted);
      font-size:13px;
    }
    
    .error{
      color:var(--danger);
    }
    
    @media (max-width:768px){
      .container{padding:20px 16px}
      header{padding:24px 20px}
      h1{font-size:24px}
      .controls{flex-direction:column;align-items:stretch}
      select,button{min-width:100%;width:100%}
      .voices-grid{
        grid-template-columns:1fr;
        padding:16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéôÔ∏è AirVoz Voice Browser</h1>
      <div class="subtitle">
        Explore premium AI voices with interactive previews. Select a language and discover professional voice talents.
      </div>
      <div class="controls">
        <select id="language">
          <option value="">Select language‚Ä¶</option>
          {% for item in languages %}
            <option value="{{ item.locale }}">{{ item.language }} ({{ item.locale }})</option>
          {% endfor %}
        </select>
        <button id="fetchBtn">
          <span>üîç Fetch Voices</span>
        </button>
        <div class="badge" id="count">0 voices</div>
      </div>
    </header>

    <div class="voices-section">
      <div class="status-bar">
        <div class="status-text" id="status">Ready to fetch voices</div>
        <div id="spinner" class="spinner" style="display:none;"></div>
      </div>
      <div id="voices" class="voices-grid"></div>
      <div id="empty" class="empty-state" style="display:none;">
        <div class="empty-icon">üé§</div>
        <div>No voices to display. Select a language and click Fetch Voices.</div>
      </div>
    </div>

    <div class="footer">
      Crafted with ‚ù§Ô∏è ‚Ä¢ Professional Voice Browser
    </div>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const status = $("#status");
    const spinner = $("#spinner");
    const voicesGrid = $("#voices");
    const empty = $("#empty");
    const count = $("#count");
    const fetchBtn = $("#fetchBtn");
    const language = $("#language");

    let currentAudio = null;
    let currentPlayBtn = null;

    function setLoading(loading, msg="") {
      status.textContent = msg || (loading ? "Fetching voices‚Ä¶" : "Ready");
      spinner.style.display = loading ? "block" : "none";
      fetchBtn.disabled = loading;
    }

    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => {
        status.textContent = "‚úÖ Copied to clipboard!";
        setTimeout(() => status.textContent = "Ready", 2000);
      }).catch(() => {
        status.textContent = "‚ö†Ô∏è Copy failed";
      });
    }

    function playVoice(url, btn) {
      if (currentAudio && !currentAudio.paused) {
        currentAudio.pause();
        if (currentPlayBtn) currentPlayBtn.classList.remove('playing');
      }

      if (currentAudio && currentAudio.src === url && currentPlayBtn === btn) {
        currentAudio.currentTime = 0;
        currentPlayBtn = null;
        currentAudio = null;
        return;
      }

      currentAudio = new Audio(url);
      currentPlayBtn = btn;
      btn.classList.add('playing');

      currentAudio.play().catch(() => {
        status.textContent = "‚ö†Ô∏è Failed to play audio";
        btn.classList.remove('playing');
      });

      currentAudio.onended = () => {
        btn.classList.remove('playing');
        currentPlayBtn = null;
      };
    }

    function createVoiceCard(v) {
      const card = document.createElement('div');
      card.className = 'voice-card';

      const avatarUrl = v.avatar_url || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="80" height="80"%3E%3Crect fill="%230f1629" width="80" height="80"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%234c8eff" font-size="32" font-family="system-ui"%3Eüé§%3C/text%3E%3C/svg%3E';

      const styleHtml = v.style ? `<span class="style-badge">${v.style}</span>` : '';

      card.innerHTML = `
        <div class="voice-header">
          <div class="avatar-wrapper">
            <img class="avatar" src="${avatarUrl}" alt="${v.name || 'Voice'}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22%3E%3Crect fill=%22%230f1629%22 width=%2280%22 height=%2280%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%234c8eff%22 font-size=%2232%22 font-family=%22system-ui%22%3Eüé§%3C/text%3E%3C/svg%3E';">
            ${v.sample_url ? `<div class="play-btn" data-url="${v.sample_url}"></div>` : ''}
          </div>
          <div class="voice-info">
            <div class="voice-name">${v.name || 'Unknown Voice'}</div>
            <div class="voice-meta">
              <span class="meta-item">${v.gender || 'N/A'}</span>
              ${v.locale ? `<span class="meta-item">‚Ä¢ ${v.locale}</span>` : ''}
              ${styleHtml}
            </div>
          </div>
        </div>
        <div class="voice-id-section">
          <div class="voice-id-text" title="${v.voice_id || ''}">${v.voice_id || 'No ID'}</div>
          <button class="copy-btn" data-copy="${v.voice_id || ''}">Copy ID</button>
        </div>
      `;

      const playBtn = card.querySelector('.play-btn');
      if (playBtn) {
        playBtn.addEventListener('click', () => {
          playVoice(playBtn.dataset.url, playBtn);
        });
      }

      const copyBtn = card.querySelector('.copy-btn');
      copyBtn.addEventListener('click', () => {
        copyText(copyBtn.dataset.copy);
      });

      return card;
    }

    async function fetchVoices() {
      const locale = language.value.trim();
      if (!locale) {
        status.textContent = "‚ö†Ô∏è Please select a language first";
        return;
      }

      setLoading(true, `Fetching voices for ${locale}‚Ä¶`);
      voicesGrid.innerHTML = "";
      empty.style.display = "none";
      count.textContent = "Loading‚Ä¶";

      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }
      if (currentPlayBtn) {
        currentPlayBtn.classList.remove('playing');
        currentPlayBtn = null;
      }

      try {
        const res = await fetch(`/api/voices?locale=${encodeURIComponent(locale)}`);
        const data = await res.json();

        if (!data.ok) {
          throw new Error(data.error || "Failed to fetch voices");
        }

        const voices = data.voices || [];
        count.textContent = `${voices.length} voices`;
        status.textContent = `‚úÖ Successfully loaded ${voices.length} voices`;

        if (voices.length === 0) {
          empty.style.display = "block";
          return;
        }

        voices.forEach(v => {
          voicesGrid.appendChild(createVoiceCard(v));
        });

      } catch (err) {
        status.innerHTML = `<span class="error">‚ùå ${err.message}</span>`;
        empty.style.display = "block";
        empty.innerHTML = `
          <div class="empty-icon">‚ö†Ô∏è</div>
          <div>Failed to load voices. Please try again.</div>
        `;
      } finally {
        setLoading(false);
      }
    }

    fetchBtn.addEventListener("click", fetchVoices);
    
    language.addEventListener("change", () => {
      if (language.value) {
        status.textContent = "Ready to fetch voices";
      }
    });
  </script>
</body>
</html>
